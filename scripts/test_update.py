import numpy as np
from UKF.constants import STATE_DIM, ALPHA, BETA, KAPPA, MEASUREMENT_DIM, INITIAL_STATE_COV
from UKF.ukf import UKF
from UKF.sigma_points import SigmaPoints
from UKF.ukf_functions import state_transition_function, measurement_function, print_c_array


sigma_points = SigmaPoints(
            # n is the dimension of the state, minus one due to the quaternion representation
            n = STATE_DIM - 1,
            alpha = ALPHA,
            beta = BETA,
            kappa = KAPPA,
        )
ukf = UKF(
            dim_x = STATE_DIM,
            dim_z = MEASUREMENT_DIM,
            points = sigma_points,
        )
ukf.X = np.array([-59.13303375, 16.82012749, 238.64797974, -15.86675262, 3.31964159, 63.72098541, 0.23608625, -0.30229792, -0.62685311, 1.47267079, 0.00057251, 0.04090103, 0.80214411, 0.06948835, 0.52495402, -0.27597019], dtype=np.float32)
ukf.P = np.array([
    [18.38045502, 2.28544760, 0.34883627, 6.29760361, 0.77246898, 0.14183037, 0.00005003, 0.00000583, 0.00000224, -0.00000000, -0.00000000, -0.00000000, 0.00001432, -0.00001399, 0.00001170,],
    [2.28544760, 9.35810184, -0.18775398, 0.77301842, 3.22553325, -0.07526305, 0.00000556, 0.00004565, 0.00000143, -0.00000000, -0.00000000, -0.00000000, 0.00000839, -0.00000872, 0.00000687,],
    [0.34883627, -0.18775398, 0.66666490, 0.13451841, -0.07264989, 0.29704472, 0.00000171, 0.00000108, 0.00004277, 0.00000000, 0.00000001, -0.00000000, 0.00001157, -0.00000577, -0.00000044,],
    [6.29760361, 0.77301842, 0.13451841, 2.22914004, 0.26507533, 0.05712611, 0.00935690, 0.00053433, 0.00019905, -0.00000004, -0.00000001, -0.00000001, 0.00135022, -0.00157568, 0.00106384,],
    [0.77246904, 3.22553325, -0.07264989, 0.26507536, 1.17354286, -0.02899574, 0.00053004, 0.00896402, 0.00013201, -0.00000004, -0.00000000, -0.00000001, 0.00096079, -0.00106590, 0.00068562,],
    [0.14183037, -0.07526305, 0.29704472, 0.05712611, -0.02899574, 0.17498647, 0.00020867, 0.00014175, 0.00868335, -0.00000000, -0.00000000, -0.00000000, 0.00032873, -0.00042953, 0.00032000,],
    [0.00005003, 0.00000556, 0.00000171, 0.00935690, 0.00053004, 0.00020867, 0.09750338, 0.00267366, 0.00098797, -0.00000029, -0.00000010, -0.00000000, 0.00805001, -0.00949262, 0.00636758,],
    [0.00000583, 0.00004565, 0.00000108, 0.00053433, 0.00896402, 0.00014175, 0.00267366, 0.09549141, 0.00066210, -0.00000020, -0.00000006, -0.00000001, 0.00578614, -0.00641649, 0.00405293,],
    [0.00000224, 0.00000143, 0.00004277, 0.00019905, 0.00013201, 0.00868335, 0.00098797, 0.00066210, 0.09409671, -0.00000007, -0.00000003, -0.00000001, 0.00177258, -0.00245388, 0.00186728,],
    [-0.00000000, -0.00000000, 0.00000000, -0.00000004, -0.00000004, -0.00000000, -0.00000029, -0.00000020, -0.00000007, 4.51266050, 0.00000029, 0.00000000, 0.00603602, -0.00753267, -0.01793060,],
    [-0.00000000, -0.00000000, 0.00000001, -0.00000001, -0.00000000, -0.00000000, -0.00000010, -0.00000006, -0.00000003, 0.00000029, 4.51266146, 0.00000000, 0.01036829, 0.01717215, -0.00366167,],
    [-0.00000000, -0.00000000, -0.00000000, -0.00000001, -0.00000001, -0.00000000, -0.00000000, -0.00000001, -0.00000001, 0.00000000, -0.00000000, 4.51266241, 0.01646655, -0.00801831, 0.00887244,],
    [0.00001432, 0.00000839, 0.00001157, 0.00135022, 0.00096079, 0.00032873, 0.00805001, 0.00578614, 0.00177258, 0.00603602, 0.01036829, 0.01646655, 0.06713281, -0.02291187, 0.01567620,],
    [-0.00001399, -0.00000872, -0.00000577, -0.00157568, -0.00106590, -0.00042953, -0.00949262, -0.00641649, -0.00245388, -0.00753267, 0.01717215, -0.00801831, -0.02291187, 0.07220088, -0.01751348,],
    [0.00001170, 0.00000687, -0.00000044, 0.00106384, 0.00068562, 0.00032000, 0.00636758, 0.00405293, 0.00186728, -0.01793060, -0.00366167, 0.00887244, 0.01567620, -0.01751348, 0.05903281,]
    ], dtype=np.float32)
ukf.F = state_transition_function
ukf.H = measurement_function
ukf._sigmas_f = np.array([
        [-59.13305283, 16.82010078, 238.64831543, -15.86674595, 3.31964636, 63.72105789, 0.23608579, -0.30229759, -0.62685239, 1.47267270, 0.00057240, 0.04090099, 0.80214113, 0.06952231, 0.52494264, -0.27599174, ],
        [-54.15172577, 17.43949699, 238.74282837, -14.16010666, 3.52899432, 63.75948334, 0.23609319, -0.30229652, -0.62685198, 1.47267270, 0.00057240, 0.04090099, 0.80214196, 0.06952318, 0.52494210, -0.27599010, ],
        [-59.13306808, 20.32007027, 238.55917358, -15.87061310, 4.52663612, 63.68523026, 0.23608591, -0.30228841, -0.62685210, 1.47267270, 0.00057240, 0.04090099, 0.80214167, 0.06952288, 0.52494222, -0.27599078, ],
        [-59.13295746, 16.82005119, 239.58805847, -15.84553719, 3.30870318, 64.14024353, 0.23608640, -0.30229601, -0.62682021, 1.47267270, 0.00057241, 0.04090099, 0.80214232, 0.06952473, 0.52494383, -0.27598545, ],
        [-59.13166046, 16.82018089, 238.64834595, -15.55691051, 3.33725405, 63.72914124, 0.25810021, -0.30048469, -0.62617779, 1.47267258, 0.00057237, 0.04090094, 0.80378276, 0.07105397, 0.52362502, -0.27331573, ],
        [-59.13305283, 16.82139587, 238.64831543, -15.86672020, 3.60766006, 63.72276306, 0.23667260, -0.28014392, -0.62641072, 1.47267258, 0.00057240, 0.04090095, 0.80321795, 0.07063381, 0.52408159, -0.27420855, ],
        [-59.13305283, 16.82010078, 238.64938354, -15.86673832, 3.31966496, 63.96072388, 0.23627004, -0.30187997, -0.60133404, 1.47267270, 0.00057237, 0.04090097, 0.80269033, 0.06991845, 0.52450246, -0.27513060, ],
        [-59.13305283, 16.82010078, 238.64831543, -15.85073471, 3.32008052, 63.72121811, 0.59822470, -0.29247689, -0.62322408, 1.47267163, 0.00057202, 0.04090097, 0.81332469, 0.08005379, 0.51556069, -0.25747138, ],
        [-59.13305283, 16.82010078, 238.64831543, -15.86674595, 3.33548403, 63.72116089, 0.23608579, 0.05592406, -0.62451714, 1.47267199, 0.00057219, 0.04090097, 0.80935454, 0.07719363, 0.51897669, -0.26391208,  ],
        [-59.13305283, 16.82010078, 238.64831543, -15.86674595, 3.31964636, 63.73677063, 0.23608579, -0.30229759, -0.27138069, 1.47267246, 0.00057229, 0.04090096, 0.80511504, 0.07144430, 0.52252215, -0.27139661, ],
        [-59.13305283, 16.82010078, 238.64831543, -15.86674595, 3.31964636, 63.72105789, 0.23608579, -0.30229759, -0.62685239, 3.94088936, 0.00057256, 0.04090099, 0.80174172, 0.07398811, 0.52339721, -0.27891102, ],
        [-59.13305283, 16.82010078, 238.64831543, -15.86674595, 3.31964636, 63.72105789, 0.23608579, -0.30229759, -0.62685239, 1.47267270, 2.46878934, 0.04090099, 0.79919505, 0.07103461, 0.52941334, -0.27561370, ],
        [-59.13305283, 16.82010078, 238.64831543, -15.86674595, 3.31964636, 63.72105789, 0.23608579, -0.30229759, -0.62685239, 1.47267270, 0.00057240, 2.50911808, 0.80364621, 0.07245997, 0.52457219, -0.27152604, ],
        [-59.13305283, 16.82010078, 238.64831543, -15.86674595, 3.31964636, 63.72105789, 0.23608579, -0.30229759, -0.62685239, 1.47267270, 0.00057240, 0.04090099, 0.78828031, 0.17051086, 0.48536023, -0.33758804, ],
        [-59.13305283, 16.82010078, 238.64831543, -15.86674595, 3.31964636, 63.72105789, 0.23608579, -0.30229759, -0.62685239, 1.47267270, 0.00057240, 0.04090099, 0.71200460, 0.08179839, 0.62943614, -0.30028081, ],
        [-59.13305283, 16.82010078, 238.64831543, -15.86674595, 3.31964636, 63.72105789, 0.23608579, -0.30229759, -0.62685239, 1.47267270, 0.00057240, 0.04090099, 0.83717167, 0.15953881, 0.50594246, -0.13309087, ],
        [-64.11437988, 16.20070457, 238.55378723, -17.57338715, 3.11029840, 63.68262863, 0.23607838, -0.30229867, -0.62685281, 1.47267270, 0.00057240, 0.04090099, 0.80214030, 0.06952144, 0.52494317, -0.27599338, ],
        [-59.13303375, 13.32013130, 238.73744202, -15.86287880, 2.11265683, 63.75688171, 0.23608567, -0.30230677, -0.62685269, 1.47267270, 0.00057240, 0.04090099, 0.80214059, 0.06952174, 0.52494305, -0.27599269, ],
        [-59.13314819, 16.82015038, 237.70857239, -15.88795471, 3.33058977, 63.30187225, 0.23608518, -0.30229917, -0.62688458, 1.47267270, 0.00057239, 0.04090099, 0.80214000, 0.06951989, 0.52494144, -0.27599803, ],
        [-59.13444519, 16.82002258, 238.64826965, -16.17658234, 3.30203867, 63.71297073, 0.21407136, -0.30411050, -0.62752700, 1.47267282, 0.00057243, 0.04090103, 0.80048835, 0.06798968, 0.52625299, -0.27866390, ],
        [-59.13305283, 16.81880569, 238.64830017, -15.86677170, 3.03163266, 63.71935272, 0.23549898, -0.32445127, -0.62729406, 1.47267282, 0.00057241, 0.04090102, 0.80105931, 0.06841038, 0.52580041, -0.27777317, ],
        [-59.13305283, 16.82010078, 238.64723206, -15.86675453, 3.31962800, 63.48139191, 0.23590153, -0.30271521, -0.65237075, 1.47267270, 0.00057243, 0.04090101, 0.80159086, 0.06912608, 0.52538216, -0.27685249, ],
        [-59.13305283, 16.82010078, 238.64831543, -15.88275719, 3.31921220, 63.72089767, -0.12605311, -0.31211829, -0.63048071, 1.47267377, 0.00057278, 0.04090100, 0.79042256, 0.05894446, 0.53397447, -0.29432803,],
        [-59.13305283, 16.82010078, 238.64831543, -15.86674595, 3.30380869, 63.72095490, 0.23608579, -0.66051924, -0.62918764, 1.47267342, 0.00057261, 0.04090101, 0.79469323, 0.06183067, 0.53075516, -0.28799072, ],
        [-59.13305283, 16.82010078, 238.64831543, -15.86674595, 3.31964636, 63.70534134, 0.23608579, -0.30229759, -0.98232412, 1.47267294, 0.00057251, 0.04090101, 0.79913557, 0.06759758, 0.52734244, -0.28057596, ],
        [-59.13305283, 16.82010078, 238.64831543, -15.86674595, 3.31964636, 63.72105789, 0.23608579, -0.30229759, -0.62685239, -0.99554396, 0.00057224, 0.04090099, 0.80251569, 0.06505436, 0.52647185, -0.27306387,],
        [-59.13305283, 16.82010078, 238.64831543, -15.86674595, 3.31964636, 63.72105789, 0.23608579, -0.30229759, -0.62685239, 1.47267270, -2.46764445, 0.04090099, 0.80506229, 0.06800789, 0.52045560, -0.27636144,],
        [-59.13305283, 16.82010078, 238.64831543, -15.86674595, 3.31964636, 63.72105789, 0.23608579, -0.30229759, -0.62685239, 1.47267270, 0.00057240, -2.42731619, 0.80061132, 0.06658266, 0.52529669, -0.28044903,],
        [-59.13305283, 16.82010078, 238.64831543, -15.86674595, 3.31964636, 63.72105789, 0.23608579, -0.30229759, -0.62685239, 1.47267270, 0.00057240, 0.04090099, 0.80336690, -0.03256132, 0.55625635, -0.21004809,],
        [-59.13305283, 16.82010078, 238.64831543, -15.86674595, 3.31964636, 63.72105789, 0.23608579, -0.30229759, -0.62685239, 1.47267270, 0.00057240, 0.04090099, 0.87640798, 0.05587080, 0.41006359, -0.24624242, ],
        [-59.13305283, 16.82010078, 238.64831543, -15.86674595, 3.31964636, 63.72105789, 0.23608579, -0.30229759, -0.62685239, 1.47267270, 0.00057240, 0.04090099, 0.74295676, -0.02258762, 0.52813584, -0.41058201,],
    ], np.float32)

ukf.R = np.float32(np.diag(np.array([1e3, 1e-1, 1e-1, 1e-1, 1, 1, 1, 1e-3, 1e-3, 1e-3], np.float32)))
z = np.array([98698.09375000, 0.37742481, -0.56745690, 0.15212949, 52.48521805, -53.75882339, 7.82915831, 0.70090938, 0.44985437, 0.55349529], np.float32)
init_mag = np.array([-0.0100306, 0.3375313, -0.9412609], np.float32)


ukf.update(z, 101861.625, init_mag, 2)

